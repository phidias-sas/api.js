!function(){"use strict";angular.module("phidias-api",["angularFileUpload"])}(),function(){"use strict";function e(){function e(e){t.host=e}function i(e,i,a){function n(){var e=a.session.get("phidiasApi.tokenString");e&&k.setToken(e)}function o(e){k.host=e}function r(e){k.listeners.login.push(e)}function l(e){k.listeners.logout.push(e)}function s(e,i){return k.post("oauth/token","grant_type=client_credentials",{headers:{Authorization:"Basic "+btoa(e+":"+i),"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){k.setToken(e.access_token);for(var i=0;i<k.listeners.login.length;i++)k.listeners.login[i](k)})}function c(e){k.token=i.decode(e),k.tokenString=e,k.isAuthenticated=!0,a.session.set("phidiasApi.tokenString",e)}function f(){k.tokenString=null,k.token=null,k.isAuthenticated=!1,a.session.clear("phidiasApi.tokenString");for(var e=0;e<k.listeners.logout.length;e++)k.listeners.logout[e](k)}function u(e,i,t){return v("get",e,i,t)}function d(e,i,t){return v("post",e,i,t)}function p(e,i,t){return v("put",e,i,t)}function m(e,i,t){return v("patch",e,i,t)}function h(e,i,t){return v("options",e,i,t)}function g(e,i,t){return v("delete",e,i,t)}function v(i,t,a,n){var o={method:i,url:k.host?k.host+"/"+t:t,data:a};return k.tokenString&&angular.extend(o,{headers:{Authorization:"Bearer "+k.tokenString}}),angular.extend(o,n),"get"==i&&(o.url+="?"+b(a),o.data=null),e(o,n)}function b(e,i){var t=[];for(var a in e)if(e.hasOwnProperty(a)){var n=i?i+"["+a+"]":a,o=e[a];if(null==o)continue;"object"==typeof o?t.push(b(o,n)):("number"==typeof o||o.length>0)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(o))}return t.join("&")}var k={host:t.host,setHost:o,tokenString:null,token:null,isAuthenticated:!1,setToken:c,login:s,logout:f,get:u,post:d,put:p,patch:m,options:h,remove:g,"delete":g,listeners:{login:[],logout:[]},onLogin:r,onLogout:l};return n(),k}var t=this;t.host=null,t.setHost=e,t.$get=i,i.$inject=["$http","phidiasApiToken","phidiasStorage"]}angular.module("phidias-api").provider("phidiasApi",e)}(),function(){"use strict";function e(){function e(e){var i=e.split(".");if(3!==i.length)throw new Error("JWT must have 3 parts");var t=a(i[1]);if(!t)throw new Error("Cannot decode the token");return JSON.parse(t)}function i(e){var i=t(e);return i?!(i.valueOf()>(new Date).valueOf()):!1}function t(i){var t;if(t=e(i),!t.exp)return null;var a=new Date(0);return a.setUTCSeconds(t.exp),a}function a(e){var i=e.replace("-","+").replace("_","/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw"Illegal base64url string!"}return decodeURIComponent(escape(window.atob(i)))}return{decode:e,isExpired:i,getExpirationDate:t}}angular.module("phidias-api").factory("phidiasApiToken",e)}(),function(){"use strict";function e(){return{session:i(window.sessionStorage),local:i(window.localStorage)}}function i(e){return{set:function(i,t){e[i]=angular.toJson(t)},get:function(i,t){return void 0===e[i]?t:angular.fromJson(e[i])},clear:function(i){return void 0!==i?e.removeItem(i):e.clear()}}}angular.module("phidias-api").factory("phidiasStorage",e)}(),function(){"use strict";function e(){function e(){function e(){a.reload()}function i(){a.icons=["fa-adjust","fa-anchor","fa-archive","fa-asterisk","fa-barcode","fa-bars","fa-beer","fa-bell","fa-bell-o","fa-bolt","fa-book","fa-bookmark","fa-bookmark-o","fa-briefcase","fa-bug","fa-building-o","fa-bullhorn","fa-bullseye","fa-calendar","fa-calendar-o","fa-camera","fa-camera-retro","fa-certificate","fa-circle","fa-circle-o","fa-clock-o","fa-cloud","fa-cloud-download","fa-cloud-upload","fa-code","fa-code-fork","fa-coffee","fa-cog","fa-cogs","fa-comment","fa-comment-o","fa-comments","fa-comments-o","fa-compass","fa-credit-card","fa-crop","fa-crosshairs","fa-cutlery","fa-desktop","fa-dot-circle-o","fa-download","fa-ellipsis-h","fa-ellipsis-v","fa-envelope","fa-envelope-o","fa-eraser","fa-exchange","fa-exclamation","fa-exclamation-circle","fa-exclamation-triangle","fa-external-link","fa-external-link-square","fa-eye","fa-eye-slash","fa-female","fa-fighter-jet","fa-film","fa-filter","fa-fire","fa-fire-extinguisher","fa-flag","fa-flag-checkered","fa-flag-o","fa-flask","fa-folder","fa-folder-o","fa-folder-open","fa-folder-open-o","fa-frown-o","fa-gamepad","fa-gavel","fa-gift","fa-glass","fa-globe","fa-hdd-o","fa-headphones","fa-heart","fa-heart-o","fa-home","fa-inbox","fa-info","fa-info-circle","fa-key","fa-keyboard-o","fa-laptop","fa-leaf","fa-lemon-o","fa-level-down","fa-level-up","fa-lightbulb-o","fa-location-arrow","fa-lock","fa-magic","fa-magnet","fa-male","fa-map-marker","fa-meh-o","fa-microphone","fa-microphone-slash","fa-minus","fa-minus-circle","fa-minus-square","fa-minus-square-o","fa-mobile","fa-money","fa-moon-o","fa-music","fa-pencil","fa-pencil-square","fa-pencil-square-o","fa-phone","fa-phone-square","fa-picture-o","fa-plane","fa-plus","fa-plus-circle","fa-plus-square","fa-plus-square-o","fa-power-off","fa-print","fa-puzzle-piece","fa-qrcode","fa-question","fa-question-circle","fa-quote-left","fa-quote-right","fa-random","fa-refresh","fa-reply","fa-reply-all","fa-retweet","fa-road","fa-rocket","fa-rss","fa-rss-square","fa-search","fa-search-minus","fa-search-plus","fa-share","fa-share-square","fa-share-square-o","fa-shield","fa-shopping-cart","fa-sign-in","fa-sign-out","fa-signal","fa-sitemap","fa-smile-o","fa-square","fa-square-o","fa-star","fa-star-half","fa-star-half-o","fa-star-o","fa-suitcase","fa-sun-o","fa-tablet","fa-tachometer","fa-tag","fa-tags","fa-tasks","fa-terminal","fa-thumb-tack","fa-thumbs-down","fa-thumbs-o-down","fa-thumbs-o-up","fa-thumbs-up","fa-ticket","fa-times","fa-times-circle","fa-times-circle-o","fa-tint","fa-trash-o","fa-trophy","fa-truck","fa-umbrella","fa-unlock","fa-unlock-alt","fa-upload","fa-user","fa-users","fa-video-camera","fa-volume-down","fa-volume-off","fa-volume-up","fa-wheelchair","fa-wrench"]}function t(e){a.ngModel=e}var a=this;a.icons=[],a.reload=i,a.selectIcon=t,e()}return{restrict:"E",scope:{url:"@",ngModel:"="},controller:e,controllerAs:"vm",bindToController:!0,template:'<ul><li ng-repeat="icon in vm.icons"><span phi-icon="{{icon}}" ng-click="vm.selectIcon(icon)" ng-class="{selected: vm.ngModel == icon}"></span></li></ul>'}}angular.module("phidias-api").directive("phidiasApiIcons",e)}(),function(){function e(){return{restrict:"E",scope:{type:"@",src:"@"},bindToController:!0,controller:i,controllerAs:"vm",template:"<div>could not load {{vm.type}} {{vm.src}}</div>"}}function i(e,i,t,a){var n="phidiasApiResource"+this.type.charAt(0).toUpperCase()+this.type.slice(1).toLowerCase()+"Directive";if(a.has(n)){var o=i("<phidias-api-resource-"+this.type+' src="{{vm.src | trustAsResourceUrl}}"></phidias-api-resource-'+this.type+">")(t);e.empty().append(o)}}angular.module("phidias-api").directive("phidiasApiResource",e),i.$inject=["$element","$compile","$scope","$injector"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{src:"@"},controller:i,controllerAs:"vm",bindToController:!0,template:'<ul><li ng-repeat="item in vm.files" class="phidias-api-resource-files-file" ng-class="{selected: selected.url == item.url}" ng-click="select(item)"><a class="thumbnail" target="_blank" href="{{item.url}}"><img ng-if="!!item.thumbnail" ng-src="{{item.thumbnail}}" /></a><a class="details" target="_blank" href="{{item.url}}"><h3 ng-bind="item.title"></h3><p>{{item.size|bytes}} - {{item.name}}</p></a></li></ul>'}}function i(e){var i=this;i.files=[],e.get(i.src).success(function(e){i.files=e})}angular.module("phidias-api").directive("phidiasApiResourceFiles",e),i.$inject=["phidiasApi"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{src:"@"},bindToController:!0,controller:i,controllerAs:"vm",template:'<form ng-if="!!vm.entity && !vm.records.length"><fieldset><div ng-repeat="field in vm.entity.fields" ng-switch="field.type" class="phidias-api-resource-form-field"><div ng-switch-when="text"><label ng-bind="field.title"></label><input ng-model="vm.currentRecord[field.name]" type="text" /></div><div ng-switch-when="textarea"><label ng-bind="field.title"></label><textarea ng-model="vm.currentRecord[field.name]"></textarea></div><div ng-switch-when="select"><label ng-bind="field.title"></label><select ng-model="vm.currentRecord[field.name]"><option value="">---</option><option ng-repeat="line in field.options | lines" value="{{line}}">{{line}}</option></select></div><div ng-switch-when="checkbox"><input type="checkbox" ng-model="vm.currentRecord[field.name]">{{field.title}}</input></div><p ng-bind="field.description"></p></div></fieldset><footer><phi-button ng-click="vm.saveCurrentRecord()">Enviar</phi-button></footer></form><div ng-if="!!vm.records.length"><fieldset ng-repeat="record in vm.records"><div ng-repeat="field in vm.entity.fields"><strong ng-bind="field.title"></strong>: <span ng-bind="record.values[field.name]"></span></div></fieldset></div>'}}function i(e){function i(){a&&e.post(a,t.currentRecord).success(function(e,i,a){t.records=[e],t.currentRecord={}})}var t=this;t.entity=null,t.records=null,t.currentRecord={},t.saveCurrentRecord=i;var a=null;e.get(t.src).success(function(i){t.entity=i,e.token&&(a="people/"+e.token.id+"/data/entities/"+t.entity.id+"/records",e.get(a).success(function(e){t.records=e}))})}angular.module("phidias-api").directive("phidiasApiResourceForm",e),i.$inject=["phidiasApi"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{src:"@"},bindToController:!0,controller:i,controllerAs:"vm",template:'<div ng-bind-html="vm.html.body"></div>'}}function i(e){var i=this;i.html=null,e.get(i.src).success(function(e){i.html=e})}angular.module("phidias-api").directive("phidiasApiResourceHtml",e),i.$inject=["phidiasApi"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{src:"@"},bindToController:!0,controller:i,controllerAs:"vm",template:'<div><iframe ng-if="!!vm.videoId" width="100%" height="420" ng-src="{{\'https://www.youtube.com/embed/\' + vm.videoId | trustAsResourceUrl}}" frameborder="0" allowfullscreen></iframe></div>'}}function i(e){var i=this;i.videoId=t(i.src)}function t(e){if(!e.trim().length)return null;var i=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,t=e.match(i);return t&&11==t[2].length?t[2]:null}angular.module("phidias-api").directive("phidiasApiResourceYoutube",e),i.$inject=["phidiasApi"]}(),function(){"use strict";function e(e,i){function t(t,a,n){t.selected=t.ngModel,t.items=[],t.uploader=null,t.reload=function(){return e.get(t.src).success(function(e){t.items=e})},t["delete"]=function(i,a){a.stopPropagation(),confirm("Eliminar este archivo?")&&e["delete"](i.endpoint+"/"+i.path).success(function(e){t.items.splice(t.items.indexOf(i),1),t.onChange({items:t.items})})},t.select=function(e){n.onSelect&&(t.selected=e,t.onSelect({item:e}))},t.change=function(i){e.put(i.endpoint+"/"+i.path,i).success(function(e){})},n.$observe("src",function(a){var n=e.host?e.host+"/"+t.src:t.src;t.uploader=new i({url:n}),t.uploader.onAfterAddingAll=function(e){t.uploader.uploadAll()},t.uploader.onCompleteAll=function(){t.uploader.clearQueue(),t.reload().success(function(){t.onChange({items:t.items})})},t.reload()}),t.clickDropZone=function(){for(var e=a.find("input"),i=0;i<e.length;i++)if("file"==e[i].type){e[i].click();break}}}return{restrict:"E",scope:{src:"@",onSelect:"&",onChange:"&"},template:'<div><ul><li ng-repeat="item in items" class="phidias-api-resource-files-file" ng-class="{selected: selected.url == item.url}" ng-click="select(item)"><a class="thumbnail" target="_blank" href="{{item.url}}"><img ng-if="!!item.thumbnail" ng-src="{{item.thumbnail}}" /></a><div class="details"><phi-input ng-model="item.title" ng-change="change(item)" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 1000, \'blur\': 0 } }"></phi-input><p>{{item.size|bytes}} - {{item.name}}</p></div><a class="phidias-api-resource-files-file-delete" ng-click="delete(item, $event)" phi-icon="fa-trash-o"></a></li></ul><div ng-if="uploader"><ul><li ng-repeat="item in uploader.queue" class="phidias-api-resource-files-file"><div class="thumbnail"><div ng-if="item.file.type.substring(0,5) == \'image\'" ng-thumb="{file: item._file, height: 100}"></div></div><div class="details"><h3 ng-bind="item.file.name"></h3></div><progress max="100" value="{{item.progress}}"></progress><a class="phidias-api-resource-files-file-delete" ng-click="item.remove()" phi-icon="fa-times"></a></li></ul><div class="phidias-api-filesystem-dropzone" nv-file-over uploader="uploader" ng-click="clickDropZone()"><div nv-file-drop uploader="uploader">Arrastra archivos aqu&iacute; o haz click</div></div><input class="file-input" type="file" nv-file-select uploader="uploader" multiple /></div></div>',link:t}}angular.module("phidias-api").directive("phidiasApiResourceFilesEditor",e),e.$inject=["phidiasApi","FileUploader"]}();