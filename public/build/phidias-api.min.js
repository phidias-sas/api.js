!function(){"use strict";angular.module("phidias-api",["angularFileUpload"])}(),function(){"use strict";function e(){return{session:t(window.sessionStorage),local:t(window.localStorage)}}function t(e){return{set:function(t,i){e[t]=angular.toJson(i)},get:function(t,i){return void 0===e[t]?i:angular.fromJson(e[t])},clear:function(t){return void 0!==t?e.removeItem(t):e.clear()}}}angular.module("phidias-api").factory("phidiasStorage",e)}(),function(){"use strict";function e(){function e(e){i.host=e}function t(e,t,n){function r(){var e=n.session.get("phidiasApi.tokenString");e&&k.setToken(e)}function o(e){k.host=e}function l(e){k.listeners.login.push(e)}function s(e){k.listeners.logout.push(e)}function a(e,t){return k.post("oauth/token","grant_type=client_credentials",{headers:{Authorization:"Basic "+btoa(e+":"+t),"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){k.setToken(e.access_token);for(var t=0;t<k.listeners.login.length;t++)k.listeners.login[t](k)})}function c(e){k.token=t.decode(e),k.tokenString=e,k.isAuthenticated=!0,n.session.set("phidiasApi.tokenString",e)}function u(){k.tokenString=null,k.token=null,k.isAuthenticated=!1,n.session.clear("phidiasApi.tokenString");for(var e=0;e<k.listeners.logout.length;e++)k.listeners.logout[e](k)}function d(e,t,i){return v("get",e,t,i)}function p(e,t,i){return v("post",e,t,i)}function f(e,t,i){return v("put",e,t,i)}function h(e,t,i){return v("patch",e,t,i)}function m(e,t,i){return v("options",e,t,i)}function g(e,t,i){return v("delete",e,t,i)}function v(t,i,n,r){var o={method:t,url:k.host?k.host+"/"+i:i,data:n};return angular.extend(o,r),k.tokenString&&angular.extend(o,{headers:{Authorization:"Bearer "+k.tokenString}}),"get"==t&&(o.url+="?"+b(n),o.data=null),e(o,r)}function b(e,t){var i=[];for(var n in e)if(e.hasOwnProperty(n)){var r=t?t+"["+n+"]":n,o=e[n];if(null==o)continue;"object"==typeof o?i.push(b(o,r)):("number"==typeof o||o.length>0)&&i.push(encodeURIComponent(r)+"="+encodeURIComponent(o))}return i.join("&")}var k={host:i.host,setHost:o,tokenString:null,token:null,isAuthenticated:!1,setToken:c,login:a,logout:u,get:d,post:p,put:f,patch:h,options:m,remove:g,"delete":g,listeners:{login:[],logout:[]},onLogin:l,onLogout:s};return r(),k}var i=this;i.host=null,i.setHost=e,i.$get=t,t.$inject=["$http","phidiasApiToken","phidiasStorage"]}angular.module("phidias-api").provider("phidiasApi",e)}(),function(){"use strict";function e(){function e(e){var t=e.split(".");if(3!==t.length)throw new Error("JWT must have 3 parts");var i=n(t[1]);if(!i)throw new Error("Cannot decode the token");return JSON.parse(i)}function t(e){var t=i(e);return t?!(t.valueOf()>(new Date).valueOf()):!1}function i(t){var i;if(i=e(t),!i.exp)return null;var n=new Date(0);return n.setUTCSeconds(i.exp),n}function n(e){var t=e.replace("-","+").replace("_","/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}return decodeURIComponent(escape(window.atob(t)))}return{decode:e,isExpired:t,getExpirationDate:i}}angular.module("phidias-api").factory("phidiasApiToken",e)}(),function(){function e(){function e(e,t,i,n){var r="phidiasApiResource"+this.type.charAt(0).toUpperCase()+this.type.slice(1).toLowerCase()+"Directive";if(n.has(r)){var o=t("<phidias-api-resource-"+this.type+' src="{{vm.src}}"></phidias-api-resource-'+this.type+">")(i);e.empty().append(o)}}return{restrict:"E",scope:{type:"@",src:"@"},bindToController:!0,controller:e,controllerAs:"vm",template:"<div>could not load {{vm.type}} {{vm.src}}</div>"}}angular.module("phidias-api").directive("phidiasApiResource",e)}(),function(){"use strict";function e(){function e(e){function t(){n&&e.post(n,i.currentRecord).success(function(e,t,n){i.records=[e],i.currentRecord={}})}var i=this;i.entity=null,i.records=null,i.currentRecord={},i.saveCurrentRecord=t;var n=null;e.get(i.src).success(function(t){i.entity=t,e.token&&(n="people/"+e.token.id+"/data/entities/"+i.entity.id+"/records",e.get(n).success(function(e){i.records=e}))})}return{restrict:"E",scope:{src:"@"},bindToController:!0,controller:e,controllerAs:"vm",template:'<form ng-if="!!vm.entity && !vm.records.length"><fieldset><div ng-repeat="field in vm.entity.fields" ng-switch="field.type" class="phidias-api-resource-form-field"><div ng-switch-when="text"><label ng-bind="field.title"></label><input ng-model="vm.currentRecord[field.name]" type="text" /></div><div ng-switch-when="textarea"><label ng-bind="field.title"></label><textarea ng-model="vm.currentRecord[field.name]"></textarea></div><div ng-switch-when="select"><label ng-bind="field.title"></label><select ng-model="vm.currentRecord[field.name]"><option value="">---</option><option ng-repeat="line in field.options | lines" value="{{line}}">{{line}}</option></select></div><div ng-switch-when="checkbox"><input type="checkbox" ng-model="vm.currentRecord[field.name]">{{field.title}}</input></div><p ng-bind="field.description"></p></div></fieldset><footer><phi-button ng-click="vm.saveCurrentRecord()">Enviar</phi-button></footer></form><div ng-if="!!vm.records.length"><fieldset ng-repeat="record in vm.records"><div ng-repeat="field in vm.entity.fields"><strong ng-bind="field.title"></strong>: <span ng-bind="record.values[field.name]"></span></div></fieldset></div>'}}angular.module("phidias-api").directive("phidiasApiResourceForm",e)}(),function(){"use strict";function e(){function e(e){var t=this;t.files=[],e.get(t.src).success(function(e){t.files=e})}return{restrict:"E",scope:{src:"@"},controller:e,controllerAs:"vm",bindToController:!0,template:'<ul><li ng-repeat="item in vm.files" class="phidias-api-resource-files-file" ng-class="{selected: selected.url == item.url}" ng-click="select(item)"><a class="thumbnail" target="_blank" href="{{item.url}}"><img ng-if="!!item.thumbnail" ng-src="{{item.thumbnail}}" /></a><a class="details" target="_blank" href="{{item.url}}"><h3 ng-bind="item.title"></h3><p>{{item.size|bytes}} - {{item.name}}</p></a></li></ul>'}}angular.module("phidias-api").directive("phidiasApiResourceFiles",e)}(),function(){"use strict";function e(){function e(e){var t=this;t.html=null,e.get(t.src).success(function(e){t.html=e})}return{restrict:"E",scope:{src:"@"},bindToController:!0,controller:e,controllerAs:"vm",template:'<div ng-bind-html="vm.html.body"></div>'}}angular.module("phidias-api").directive("phidiasApiResourceHtml",e)}(),function(){"use strict";function e(){function e(e){var i=this;i.videoId=t(i.src)}function t(e){if(!e.trim().length)return null;var t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,i=e.match(t);return i&&11==i[2].length?i[2]:null}return{restrict:"E",scope:{src:"@"},bindToController:!0,controller:e,controllerAs:"vm",template:'<div><iframe ng-if="!!vm.videoId" width="100%" height="420" ng-src="{{\'http://www.youtube.com/embed/\' + vm.videoId | trustAsResourceUrl}}" frameborder="0" allowfullscreen></iframe></div>'}}angular.module("phidias-api").directive("phidiasApiResourceYoutube",e)}(),function(){"use strict";function e(e,t){function i(i,n,r){i.selected=i.ngModel,i.items=[],i.uploader=null,i.reload=function(){return e.get(i.src).success(function(e){i.items=e})},i["delete"]=function(t,n){n.stopPropagation(),confirm("Eliminar este archivo?")&&e["delete"](t.endpoint+"/"+t.path).success(function(e){i.items.splice(i.items.indexOf(t),1),i.onChange({items:i.items})})},i.select=function(e){r.onSelect&&(i.selected=e,i.onSelect({item:e}))},i.change=function(t){e.put(t.endpoint+"/"+t.path,t).success(function(e){})},r.$observe("src",function(n){var r=e.host?e.host+"/"+i.src:i.src;i.uploader=new t({url:r}),i.uploader.onAfterAddingAll=function(e){i.uploader.uploadAll()},i.uploader.onCompleteAll=function(){i.uploader.clearQueue(),i.reload().success(function(){i.onChange({items:i.items})})},i.reload()}),i.clickDropZone=function(){for(var e=n.find("input"),t=0;t<e.length;t++)if("file"==e[t].type){e[t].click();break}}}return{restrict:"E",scope:{src:"@",onSelect:"&",onChange:"&"},template:'<div><ul><li ng-repeat="item in items" class="phidias-api-resource-files-file" ng-class="{selected: selected.url == item.url}" ng-click="select(item)"><a class="thumbnail" target="_blank" href="{{item.url}}"><img ng-if="!!item.thumbnail" ng-src="{{item.thumbnail}}" /></a><div class="details"><phi-input ng-model="item.title" ng-change="change(item)" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 1000, \'blur\': 0 } }"></phi-input><p>{{item.size|bytes}} - {{item.name}}</p></div><a class="phidias-api-resource-files-file-delete" ng-click="delete(item, $event)" phi-icon="fa-trash-o"></a></li></ul><div ng-if="uploader"><ul><li ng-repeat="item in uploader.queue" class="phidias-api-resource-files-file"><div class="thumbnail"><div ng-if="item.file.type.substring(0,5) == \'image\'" ng-thumb="{file: item._file, height: 100}"></div></div><div class="details"><h3 ng-bind="item.file.name"></h3></div><progress max="100" value="{{item.progress}}"></progress><a class="phidias-api-resource-files-file-delete" ng-click="item.remove()" phi-icon="fa-times"></a></li></ul><div class="phidias-api-filesystem-dropzone" nv-file-over uploader="uploader" ng-click="clickDropZone()"><div nv-file-drop uploader="uploader">Arrastra archivos aqu&iacute; o haz click</div></div><input class="file-input" type="file" nv-file-select uploader="uploader" multiple /></div></div>',link:i}}angular.module("phidias-api").directive("phidiasApiResourceFilesEditor",e),e.$inject=["phidiasApi","FileUploader"]}();