!function(){"use strict";angular.module("phidias-api",["angularFileUpload"])}(),function(){"use strict";function e(){return{session:i(window.sessionStorage),local:i(window.localStorage)}}function i(e){return{set:function(i,t){e[i]=angular.toJson(t)},get:function(i,t){return void 0===e[i]?t:angular.fromJson(e[i])},clear:function(i){return void 0!==i?e.removeItem(i):e.clear()}}}angular.module("phidias-api").factory("phidiasStorage",e)}(),function(){"use strict";function e(){function e(e){t.host=e}function i(e,i,n){function r(){var e=n.session.get("phidiasApi.tokenString");e&&k.setToken(e)}function o(e){k.host=e}function l(e){k.listeners.login.push(e)}function s(e){k.listeners.logout.push(e)}function a(e,i){return k.post("oauth/token","grant_type=client_credentials",{headers:{Authorization:"Basic "+btoa(e+":"+i),"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){k.setToken(e.access_token);for(var i=0;i<k.listeners.login.length;i++)k.listeners.login[i](k)})}function c(e){k.token=i.decode(e),k.tokenString=e,k.isAuthenticated=!0,n.session.set("phidiasApi.tokenString",e)}function u(){k.tokenString=null,k.token=null,k.isAuthenticated=!1,n.session.clear("phidiasApi.tokenString");for(var e=0;e<k.listeners.logout.length;e++)k.listeners.logout[e](k)}function d(e,i,t){return v("get",e,i,t)}function p(e,i,t){return v("post",e,i,t)}function f(e,i,t){return v("put",e,i,t)}function h(e,i,t){return v("patch",e,i,t)}function m(e,i,t){return v("options",e,i,t)}function g(e,i,t){return v("delete",e,i,t)}function v(i,t,n,r){var o={method:i,url:k.host?k.host+"/"+t:t,data:n};return angular.extend(o,r),k.tokenString&&angular.extend(o,{headers:{Authorization:"Bearer "+k.tokenString}}),"get"==i&&(o.url+="?"+b(n),o.data=null),e(o,r)}function b(e,i){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var r=i?i+"["+n+"]":n,o=e[n];if(null==o)continue;"object"==typeof o?t.push(b(o,r)):("number"==typeof o||o.length>0)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(o))}return t.join("&")}var k={host:t.host,setHost:o,tokenString:null,token:null,isAuthenticated:!1,setToken:c,login:a,logout:u,get:d,post:p,put:f,patch:h,options:m,remove:g,"delete":g,listeners:{login:[],logout:[]},onLogin:l,onLogout:s};return r(),k}var t=this;t.host=null,t.setHost=e,t.$get=i,i.$inject=["$http","phidiasApiToken","phidiasStorage"]}angular.module("phidias-api").provider("phidiasApi",e)}(),function(){"use strict";function e(){function e(e){var i=e.split(".");if(3!==i.length)throw new Error("JWT must have 3 parts");var t=n(i[1]);if(!t)throw new Error("Cannot decode the token");return JSON.parse(t)}function i(e){var i=t(e);return i?!(i.valueOf()>(new Date).valueOf()):!1}function t(i){var t;if(t=e(i),!t.exp)return null;var n=new Date(0);return n.setUTCSeconds(t.exp),n}function n(e){var i=e.replace("-","+").replace("_","/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw"Illegal base64url string!"}return decodeURIComponent(escape(window.atob(i)))}return{decode:e,isExpired:i,getExpirationDate:t}}angular.module("phidias-api").factory("phidiasApiToken",e)}(),function(){function e(){return{restrict:"E",scope:{type:"@",src:"@"},bindToController:!0,controller:i,controllerAs:"vm",template:"<div>could not load {{vm.type}} {{vm.src}}</div>"}}function i(e,i,t,n){var r="phidiasApiResource"+this.type.charAt(0).toUpperCase()+this.type.slice(1).toLowerCase()+"Directive";if(n.has(r)){var o=i("<phidias-api-resource-"+this.type+' src="{{vm.src}}"></phidias-api-resource-'+this.type+">")(t);e.empty().append(o)}}angular.module("phidias-api").directive("phidiasApiResource",e),i.$inject=["$element","$compile","$scope","$injector"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{src:"@"},controller:i,controllerAs:"vm",bindToController:!0,template:'<ul><li ng-repeat="item in vm.files" class="phidias-api-resource-files-file" ng-class="{selected: selected.url == item.url}" ng-click="select(item)"><a class="thumbnail" target="_blank" href="{{item.url}}"><img ng-if="!!item.thumbnail" ng-src="{{item.thumbnail}}" /></a><a class="details" target="_blank" href="{{item.url}}"><h3 ng-bind="item.title"></h3><p>{{item.size|bytes}} - {{item.name}}</p></a></li></ul>'}}function i(e){var i=this;i.files=[],e.get(i.src).success(function(e){i.files=e})}angular.module("phidias-api").directive("phidiasApiResourceFiles",e),i.$inject=["phidiasApi"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{src:"@"},bindToController:!0,controller:i,controllerAs:"vm",template:'<form ng-if="!!vm.entity && !vm.records.length"><fieldset><div ng-repeat="field in vm.entity.fields" ng-switch="field.type" class="phidias-api-resource-form-field"><div ng-switch-when="text"><label ng-bind="field.title"></label><input ng-model="vm.currentRecord[field.name]" type="text" /></div><div ng-switch-when="textarea"><label ng-bind="field.title"></label><textarea ng-model="vm.currentRecord[field.name]"></textarea></div><div ng-switch-when="select"><label ng-bind="field.title"></label><select ng-model="vm.currentRecord[field.name]"><option value="">---</option><option ng-repeat="line in field.options | lines" value="{{line}}">{{line}}</option></select></div><div ng-switch-when="checkbox"><input type="checkbox" ng-model="vm.currentRecord[field.name]">{{field.title}}</input></div><p ng-bind="field.description"></p></div></fieldset><footer><phi-button ng-click="vm.saveCurrentRecord()">Enviar</phi-button></footer></form><div ng-if="!!vm.records.length"><fieldset ng-repeat="record in vm.records"><div ng-repeat="field in vm.entity.fields"><strong ng-bind="field.title"></strong>: <span ng-bind="record.values[field.name]"></span></div></fieldset></div>'}}function i(e){function i(){n&&e.post(n,t.currentRecord).success(function(e,i,n){t.records=[e],t.currentRecord={}})}var t=this;t.entity=null,t.records=null,t.currentRecord={},t.saveCurrentRecord=i;var n=null;e.get(t.src).success(function(i){t.entity=i,e.token&&(n="people/"+e.token.id+"/data/entities/"+t.entity.id+"/records",e.get(n).success(function(e){t.records=e}))})}angular.module("phidias-api").directive("phidiasApiResourceForm",e),i.$inject=["phidiasApi"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{src:"@"},bindToController:!0,controller:i,controllerAs:"vm",template:'<div ng-bind-html="vm.html.body"></div>'}}function i(e){var i=this;i.html=null,e.get(i.src).success(function(e){i.html=e})}angular.module("phidias-api").directive("phidiasApiResourceHtml",e),i.$inject=["phidiasApi"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{src:"@"},bindToController:!0,controller:i,controllerAs:"vm",template:'<div><iframe ng-if="!!vm.videoId" width="100%" height="420" ng-src="{{\'http://www.youtube.com/embed/\' + vm.videoId | trustAsResourceUrl}}" frameborder="0" allowfullscreen></iframe></div>'}}function i(e){var i=this;i.videoId=t(i.src)}function t(e){if(!e.trim().length)return null;var i=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,t=e.match(i);return t&&11==t[2].length?t[2]:null}angular.module("phidias-api").directive("phidiasApiResourceYoutube",e),i.$inject=["phidiasApi"]}(),function(){"use strict";function e(e,i){function t(t,n,r){t.selected=t.ngModel,t.items=[],t.uploader=null,t.reload=function(){return e.get(t.src).success(function(e){t.items=e})},t["delete"]=function(i,n){n.stopPropagation(),confirm("Eliminar este archivo?")&&e["delete"](i.endpoint+"/"+i.path).success(function(e){t.items.splice(t.items.indexOf(i),1),t.onChange({items:t.items})})},t.select=function(e){r.onSelect&&(t.selected=e,t.onSelect({item:e}))},t.change=function(i){e.put(i.endpoint+"/"+i.path,i).success(function(e){})},r.$observe("src",function(n){var r=e.host?e.host+"/"+t.src:t.src;t.uploader=new i({url:r}),t.uploader.onAfterAddingAll=function(e){t.uploader.uploadAll()},t.uploader.onCompleteAll=function(){t.uploader.clearQueue(),t.reload().success(function(){t.onChange({items:t.items})})},t.reload()}),t.clickDropZone=function(){for(var e=n.find("input"),i=0;i<e.length;i++)if("file"==e[i].type){e[i].click();break}}}return{restrict:"E",scope:{src:"@",onSelect:"&",onChange:"&"},template:'<div><ul><li ng-repeat="item in items" class="phidias-api-resource-files-file" ng-class="{selected: selected.url == item.url}" ng-click="select(item)"><a class="thumbnail" target="_blank" href="{{item.url}}"><img ng-if="!!item.thumbnail" ng-src="{{item.thumbnail}}" /></a><div class="details"><phi-input ng-model="item.title" ng-change="change(item)" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 1000, \'blur\': 0 } }"></phi-input><p>{{item.size|bytes}} - {{item.name}}</p></div><a class="phidias-api-resource-files-file-delete" ng-click="delete(item, $event)" phi-icon="fa-trash-o"></a></li></ul><div ng-if="uploader"><ul><li ng-repeat="item in uploader.queue" class="phidias-api-resource-files-file"><div class="thumbnail"><div ng-if="item.file.type.substring(0,5) == \'image\'" ng-thumb="{file: item._file, height: 100}"></div></div><div class="details"><h3 ng-bind="item.file.name"></h3></div><progress max="100" value="{{item.progress}}"></progress><a class="phidias-api-resource-files-file-delete" ng-click="item.remove()" phi-icon="fa-times"></a></li></ul><div class="phidias-api-filesystem-dropzone" nv-file-over uploader="uploader" ng-click="clickDropZone()"><div nv-file-drop uploader="uploader">Arrastra archivos aqu&iacute; o haz click</div></div><input class="file-input" type="file" nv-file-select uploader="uploader" multiple /></div></div>',link:t}}angular.module("phidias-api").directive("phidiasApiResourceFilesEditor",e),e.$inject=["phidiasApi","FileUploader"]}();